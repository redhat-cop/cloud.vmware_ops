# vars.yaml
provision_vm_hostname: "{{ vcenter_hostname }}"
provision_vm_username: "{{ vcenter_username }}"
provision_vm_password: "{{ vcenter_password }}"
provision_vm_validate_certs: false

provision_vm_cluster: "Eco-Cluster"
provision_vm_folder: "/Eco-Datacenter/vm/e2e-qe"
provision_vm_datacenter: "Eco-Datacenter"

# Create VM template
provision_vms_template:
  - provision_vm_name: "qe-provision-vm-template"
    provision_vm_state: "poweredoff"
    provision_vm_cdrom:
      - controller_number: 0
        unit_number: 0
        state: present
        type: iso
        iso_path: "[datastore1] ISO/rhel-9.3-x86_64-dvd.iso"
    provision_vm_networks:
      - name: "VM Network"
        device_type: "vmxnet3"
        mac: "00:50:56:bd:d2:9e"
        type: "dhcp"
    provision_vm_resource_pool: null
    provision_vm_disk:
      - size_gb: 50
        type: thin
        datastore: "datastore1"
    provision_vm_hardware:
      memory_mb: 2000
      num_cpus: 4
      boot_firmware: efi
      secure_boot: true
    provision_vm_guest_id: "rhel9_64Guest"
    provision_vm_datastore: "datastore1"

# Provision VMs from template
provision_vms_from_template:
  - provision_vm_name: "qe-provision-vm-from-template"
    provision_vm_state: "poweredon"
    provision_vm_template: "{{ provision_vms_template[0].provision_vm_name }}"
    provision_vm_datastore: "datastore1"

provision_vms:
# RHEL9 VM
  - provision_vm_name: "qe-provision-vm-rhel-9"
    provision_vm_state: "poweredon"
    provision_vm_cdrom:
      - controller_number: 0
        unit_number: 0
        state: present
        type: iso
        iso_path: "[datastore1] ISO/rhel-9.3-x86_64-dvd.iso"
    provision_vm_networks:
      - name: "VM Network"
        device_type: "vmxnet3"
        mac: "00:50:56:bd:d2:9e"
        type: "dhcp"
        # ip: "192.168.168.10"
        # netmask: "255.255.255.0"
        # gateway: "10.185.246.1"
    # provision_vm_esxi_hostname: "10.185.246.5"
    # provision_vm_state:
    #   poweredOff: "poweredoff"
    #   poweredOn: "poweredon"
    #   suspended: "suspended"
    provision_vm_resource_pool: null
    # provision_vm_port: "8989"
    provision_vm_disk:
      - size_gb: 50
        type: thin
        datastore: "datastore1"
    provision_vm_hardware:
      memory_mb: 2000
      num_cpus: 4
      boot_firmware: efi
      secure_boot: true
    provision_vm_guest_id: "rhel9_64Guest"
    provision_vm_datastore: "datastore1"
# RHEL8 VM
  - provision_vm_name: "qe-provision-vm-rhel-8"
    provision_vm_state: "poweredon"
    provision_vm_cdrom:
      - controller_number: 0
        unit_number: 0
        state: present
        type: iso
        iso_path: "[datastore1] ISO/rhel-8.9-x86_64-boot.iso"
    provision_vm_networks:
      - name: "VM Network"
        device_type: "vmxnet3"
        mac: "00:50:56:bd:d2:9e"
        type: "dhcp"
        # ip: "192.168.168.10"
        # netmask: "255.255.255.0"
        # gateway: "10.185.246.1"
    # provision_vm_esxi_hostname: "10.185.246.5"
    provision_vm_resource_pool: null
    # provision_vm_port: "8989"
    provision_vm_disk:
      - size_gb: 50
        type: thin
        datastore: "datastore1"
    provision_vm_hardware:
      memory_mb: 2000
      num_cpus: 4
      boot_firmware: efi
      secure_boot: true
    provision_vm_guest_id: "rhel8_64Guest"
    provision_vm_datastore: "datastore1"

vm_to_update: "{{ provision_vms[0] }}"
vm_update_name: "{{ vm_to_update.provision_vm_name }}"
vm_update_datastore: "{{ vm_to_update.provision_vm_datastore }}"

vm_names_to_update:
  - vm_updated_name
  - "{{ vm_update_name }}"

vm_states:
#  - "rebootguest" # error msg: "VMware tools should be installed for guest shutdown/reboot"
#  - "shutdownguest" # error msg: "VMware tools should be installed for guest shutdown/reboot"
#  - "restarted" # test failing because after restart the status is poweredOn again
  - "suspended"
  - "poweredon"
  - "poweredoff"

vm_updated_hardware:
  memory_mb: 2048
  num_cpus: 6
  num_cpu_cores_per_socket: 2
  boot_firmware: efi
  secure_boot: true

vswitch_name: vSwitch0
portgroup_name: qe-network

vm_network_to_add:
  - name: "{{ portgroup_name }}"
    device_type: "vmxnet3"
    mac: "00:50:a6:b5:b2:3c"
    type: "dhcp"

vm_updated_networks: "{{ vm_to_update.provision_vm_networks + vm_network_to_add }}"

vm_enlarge_disk:
  - size_gb: "{{ vm_to_update.provision_vm_disk[0].size_gb + 10 }}"
    type: "{{ vm_to_update.provision_vm_disk[0].type }}"
    datastore: "{{ vm_to_update.provision_vm_disk[0].datastore }}"

vm_disk_to_add:
  - size_gb: 10
    type: thin
    datastore: "datastore1"

vm_add_disk: "{{ vm_to_update.provision_vm_disk + vm_disk_to_add }}"

guest_fullnames:
  rhel8_64Guest: "Red Hat Enterprise Linux 8 (64-bit)"
  rhel9_64Guest: "Red Hat Enterprise Linux 9 (64-bit)"

vm_updated_guest_id: "rhel8_64Guest"
vm_updated_cdrom:
  - controller_number: 0
    unit_number: 0
    state: present
    type: iso
    iso_path: "[datastore1] ISO/rhel-8.9-x86_64-boot.iso"

vm_update_os_customization:
  existing_vm: true
  hostname: my.customized.vm
  timezone: Europe/Paris

gib_to_bytes: 1073741824